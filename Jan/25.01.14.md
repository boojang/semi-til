# âœ´ï¸TIL

## ë‚ ì§œ: 2025-01-06

### ìŠ¤í¬ëŸ¼

- í•™ìŠµ ëª©í‘œ 1:  Model ìŠ¤í¬ë¦½íŠ¸ ìž‘ì„± âœ…
- í•™ìŠµ ëª©í‘œ 2: K8S ë³µìŠµ ðŸ”¥ðŸ”¥

### ìƒˆë¡œ ë°°ìš´ ë‚´ìš©

## 1ï¸âƒ£ì£¼ì œ 1: CORS

### CORS (Cross-Origin Resource Sharing)

HTTP-header based mechanism that allows a server to indicate any origins, other than its own, from which a browser should permit loading resources

**ê°œë…**

- HTTP í—¤ë” ê¸°ë°˜ ë©”ì»¤ë‹ˆì¦˜
- ìžì‹ ì˜ ì¶œì²˜(orgin)ê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì¶œì²˜ì˜ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìžˆë„ë¡ í—ˆìš©í•˜ë„ë¡ í•œë‹¤.
- ì„œë²„ê°€ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ í•´ë‹¹ ì •ë³´ë¥¼ ì½ëŠ” ê²ƒì´ í—ˆìš©ë˜ì—ˆìŒì„ ì¦ëª…í•˜ê¸° ìœ„í•´ ìƒˆë¡œìš´ HTTP í—¤ë”ë¥¼ ì¶”ê°€í•œë‹¤.
- ìš”ì²­ì˜ íŠ¹ì„±ì— ë”°ë¼ ë‹¨ìˆœ ìš”ì²­(Simple Request), í”„ë¦¬í”Œë¼ì´íŠ¸ ìš”ì²­(Prefight Request)ë¡œ ë¶„ë¥˜ëœë‹¤.

**ë„ìž… ë°°ê²½**

- í˜„ëŒ€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë‹¤ì–‘í•œ ì¶œì²˜ì˜ ë¦¬ì†ŒìŠ¤ì™€ ë°ì´í„°ë¥¼ í™œìš©í•˜ëŠ” ê²½ìš°ê°€ ì¦ê°€í–ˆë‹¤.
    
    ex) í”„ë¡ íŠ¸ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ë„ë©”ì¸ì´ ë‹¤ë¥¸ API ì„œë²„ê°€ í†µì‹  â†’ ì´ ê²½ìš° SOPê°€ ì œì•½ì´ ëœë‹¤.
    
    Same-Origin-Polity (SOP)
    
    ì›¹ íŽ˜ì´ì§€ê°€ ìžì‹ ê³¼ ë™ì¼í•œ ì¶œì²˜(í”„ë¡œí† ì½œ, ë„ë©”ì¸, í¬íŠ¸ ë™ì¼)ì—ì„œë§Œ ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•˜ê³  ìƒí˜¸ìž‘ìš©í•  ìˆ˜ ìžˆë„ë¡ ì œí•œí•œë‹¤.
    
    â†’ ì•…ì˜ì ì¸ ì‚¬ì´íŠ¸ê°€ ì‚¬ìš©ìžì˜ ë¯¼ê°í•œ ì •ë³´ë¥¼ ê°€ì ¸ê°€ëŠ” ê²ƒì„ ë°©ì§€í•œë‹¤.
    

**ì˜ˆì‹œ**

- `https://domain-a.com`  â†’ [`https://domain-b.com/data.json`](https://domain-b.com/data.json) ë¡œ ìš”ì²­ ì „ì†¡
- ì„œë²„(domain-b.com)ì€ ì‘ë‹µ í—¤ë”ì— `Access-Control-Allow-Origin: https://domain-a.com` ì„ í¬í•¨ì‹œì¼œ í•´ë‹¹ ì¶œì²˜ì˜ ìš”ì²­ì„ í—ˆìš©í•  ìˆ˜ ìžˆë‹¤.

    
    ## Simple Request
    
    1. ì‚¬ì „ ìš”ì²­ì„ ìƒëžµí•˜ê³ (Preflight) ë°”ë¡œ ì„œë²„ì— ì „ì†¡ë˜ëŠ” ìš”ì²­
    2. ë¸Œë¼ìš°ì €ëŠ” ë°”ë¡œ ìš”ì²­ì„ ë³´ë‚´ê³ , ì„œë²„ëŠ” `Access-Control-Allow-Origin`  í—¤ë”ë¡œ ì‘ë‹µí•œë‹¤.
    3. ë‹¤ìŒ ì¡°ê±´ì„ ëª¨ë‘ ë§Œì¡±í•´ì•¼ í•œë‹¤
        
        Simple Request ì¡°ê±´
        
        **HTTP ë©”ì„œë“œ**
        
        GET, HEAD, POST ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•œë‹¤.
        
        **í—¤ë” ì œí•œ**
        
        `Accept`, `Accept-Language`, `Content-Language`, `Content-Type` ë“± íŠ¹ì • í‘œì¤€ í—¤ë”ë§Œ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤. 
        
        ì‚¬ìš©ìž ì •ì˜ í—¤ë”ëŠ” í¬í•¨ë˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.
        
        **Content-Type ì œí•œ**
        
        `Content-Type` í—¤ë”ì˜ ê°’ì´ `application/x-www-form-urlencoded`, `multipart/form-data`, `text/plain` ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•œë‹¤.
        â†’ ìµœê·¼ HTTP ìš”ì²­ì€ application/json ë˜ëŠ” text/xmlë¡œ ì´ë¤„ì§€ê¸° ë•Œë¬¸ì— ëŒ€ë¶€ë¶„ 3ë²ˆì§¸ Content-Type í—¤ë” ì¡°ê±´ì„ ë§Œì¡±ì‹œí‚¤ì§€ ëª»í•œë‹¤.
        
    4. ì˜ˆì‹œ
    
    ```jsx
    // í”„ë¡ íŠ¸ì—”ë“œ
    fetch("https://api.example.com/data", {
      method: "GET",
    })
      .then((response) => response.json())
      .then((data) => console.log(data));
      
    // ì„œë²„ ì‘ë‹µ í—¤ë”
    HTTP/1.1 200 OK
    Access-Control-Allow-Origin: https://your-frontend.com
    Content-Type: application/json
    ```
    
    >ì‚¬ì „ í—ˆìš© ì—¬ë¶€ ì—†ì´ ë³´ë‚¼ ìˆ˜ ìžˆëŠ” ì´ìœ 
    >
    >**Simple Requestì˜ ì—„ê²©í•œ ì¡°ê±´**
    >  â†’ ì´ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ìš”ì²­ì€ ë³´ì•ˆìƒ ìƒëŒ€ì ìœ¼ë¡œ ì•ˆì „í•˜ë‹¤ê³  ê°„ì£¼ë˜ê¸° ë•Œë¬¸ì— ì„œë²„ì— í—ˆìš© ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì§€ ì•Šê³ ë„ ë°”ë¡œ ë³´ë‚¼ ìˆ˜ ìžˆë‹¤.

    
    ## Preflight Request
    
    1. ë¸Œë¼ìš°ì €ëŠ” ì‹¤ì œ ìš”ì²­ ì „ Prefilght Requestì„ í†µí•´ ì„œë²„ì˜ í—ˆìš© ì—¬ë¶€ë¥¼ í™•ì¸í•´ì•¼í•œë‹¤.
        
        â†’ í—ˆìš©ë˜ëŠ” method, orginì´ ë¬´ì—‡ì¸ì§€ ë¨¼ì € í™•ì¸í•œë‹¤.
        
    2. **ë™ìž‘**
        1. ë¸Œë¼ìš°ì €ëŠ” OPTIONS ë©”ì„œë“œë¡œ ì„œë²„ì— ì‚¬ì „ ìš”ì²­ì„ ë³´ë‚¸ë‹¤
        2. ì„œë²„ê°€ ì‘ë‹µ í—¤ë”ë¥¼ í†µí•´ í—ˆìš©ëœ ë©”ì„œë“œ, í—¤ë”ë¥¼ ë°˜í™˜í•˜ë©´ ì‹¤ì œ ìš”ì²­ì´ ì§„í–‰ëœë‹¤.
        3. ì˜ˆì‹œ
        
        ```jsx
        // í”„ë¡ íŠ¸ì—”ë“œ
        fetch("https://api.example.com/data", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer token",
          },
          body: JSON.stringify({ key: "value" }),
        });
        
        //ë¸Œë¼ìš°ì €ê°€ ë³´ë‚¼ ì‚¬ì „ ìš”ì²­ (OPTIONS)
        OPTIONS /data HTTP/1.1
        Origin: https://your-frontend.com
        Access-Control-Request-Method: POST
        Access-Control-Request-Headers: Content-Type, Authorization
        
        //ì„œë²„ ì‘ë‹µí—¤ë”
        HTTP/1.1 204 No Content
        Access-Control-Allow-Origin: https://your-frontend.com
        Access-Control-Allow-Methods: POST, GET, OPTIONS
        Access-Control-Allow-Headers: Content-Type, Authorization
        ```
        
    
    >`OPTIONS` ìš”ì²­ì€ í”„ë¡ íŠ¸ ì½”ë“œì— ëª…ì‹œë˜ì§€ ì•Šì•„ë„ ë˜ëŠ”ê°€?
    >
    >ë¸Œë¼ìš°ì €ê°€ ìžë™ìœ¼ë¡œ ìƒì„±í•´ì„œ ë³´ë‚´ê¸° ë•Œë¬¸ì— í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìžê°€ ì§ì ‘ ìž‘ì„±í•  í•„ìš”ëŠ” ì—†ë‹¤.
    >
    >ë™ìž‘ ë°©ì‹
    >
    >1. ë¸Œë¼ìš°ì €ê°€ CORS ì •ì±…ì— ë”°ë¼ ìš”ì²­ì´ `Simple Request` ì¡°ê±´ì— ë§žì§€ ì•ŠëŠ”ë‹¤ê³  íŒë‹¨í•˜ë©´, ìžë™ìœ¼ë¡œ **ì‚¬ì „ ìš”ì²­(Preflight)** ì„ ë³´ë‚¸ë‹¤.
    >2. `OPTIONS` ìš”ì²­ì´ í¬í•¨ë˜ì–´ ì„œë²„ì— í—ˆìš© ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤.
    >3. ì„œë²„ê°€ `Access-Control-Allow-*` í—¤ë”ë¥¼ í†µí•´ í—ˆìš©ëœ ìš”ì²­ìž„ì„ ì‘ë‹µí•˜ë©´, ë¸Œë¼ìš°ì €ê°€ ì‹¤ì œ ìš”ì²­(`POST`)ì„ ë³´ë‚¸ë‹¤.
    >
    >```jsx
    >1. ë¸Œë¼ìš°ì € -> ì„œë²„: OPTIONS ìš”ì²­ (ì‚¬ì „ ìš”ì²­)
    >2. ì„œë²„ -> ë¸Œë¼ìš°ì €: ì‚¬ì „ ìš”ì²­ ì‘ë‹µ (í—ˆìš© ì—¬ë¶€ ì •ë³´ í¬í•¨)
    >3. ë¸Œë¼ìš°ì € -> ì„œë²„: ì‹¤ì œ ìš”ì²­ (POST)
    >4. ì„œë²„ -> ë¸Œë¼ìš°ì €: ì‹¤ì œ ìš”ì²­ ì‘ë‹µ
    >```
